# gitinsky-com

## 1)
> Есть 2 prometheus в конфедерации, в один летит шквал метрик от серверов, метрики имеют общий префикс `systemd_*_*_*` и нужно на нём ограничить фильтром так, чтобы `{state="Active"}` пропускались, а `{state="Disabled"}` не пропускались. в какую сторону посмотрите?
###### Ответ (теоретический, проверить не на чем)
```
scrape_configs:
  - job_name: job

    static_configs:
      - targets:
        - server:1234

    metric_relabel_configs:
    - source_labels: [__name__, 'state']
      separator:     ';'
      regex:         'systemd_.*_.*_.*;Disabled'
      action: drop # drop: Drop targets for which regex matches the concatenated source_labels.

    - source_labels: ['__name__', 'state']
      separator:     ';'
      regex:         'systemd_.*_.*_.*;Active'
      action: keep # keep: Drop targets for which regex does not match the concatenated source_labels
```
## 2)
> За какое время сможете написать ansible-playbook который раскатает strongswan сервер к которому могут подключиться iphone, mac, windows для среднего офиса, vpn-сервер стоит за NAT, Cisco 2901?
Количество пользователей 50 логины/пароли статические.
Для простоты считаем, что циско-админ настроит проброс портов так, как мы скажем.

###### Ответ
```
На изучение strongswan ушло 2 часа
на ansible-playbook ушло 3-4 часа. 

Бука создает сервер, который только принимает подключения. маршрутизация не настроена.
необходимо устновить переменную strongswan_server_ip - внешний ИП сервера(Cisco 2901). на  Cisco 2901 пробросить UDP 500+4500
остается открытым вопрос с CA и сертификатом сервера. кто его создает?
остается открытым вопрос со списком пользователей - кто его создает?

не учитывая все эти нюанся полкчаем такой скрипт
ansible-playbook strongswan.yml -e "hostname=server" -e "ansible_user=root" -kK
```
## 3)
> Имеется сильно нагруженный пользователями сервер на php/mysql стеке, проблемы: тормозит, "ресурс недоступен". что будете смотреть в каком порядке, как будете действовать? 36vCPU, 80Gb vRAM, 2Tb vDISK (SAN)
###### Ответ
```
предлагаю
- посмотреть логи PHP
- посмотреть логи mysql
- возможно включить расширенное логирование
- посмотреть загрузку сервера:память, цп, диски. кто сколько пользует
- в mysql посмотреть меделнные запросы
```
## 4)
> кейс: клиентская команда разработки из двух человек ведет проект на стеке php/mysql. Устоявшиеся процессы выглядят следующим образом:
каждый из разработчиков ведет разработку своей части сервиса на локальной копии проекта (в контейнере).
изменения пушатся в бесплатный репозиторий на github.
 деплой изменений на боевое окружение производится средствами git, непосредственно на единственном сервере приложений боевого окружения (pull нужной ветки из репозитория github).
Сервис развивается, в команду берут еще двух разработчиков.
Порекомендуйте изменение workflow и инструменты, которые позволили бы этой команде продолжить разработку сервиса, избежав организационных и технических проблем.

###### Ответ
```
отсутствуют необходимые опвт и знания в данном вопросе
```
## 5)
> Напишите плейбук ansible, который делает следующее:
- ставит nginx, zsh, wget
- клонирует из git в /var/www/ очень простую web страничку "Under construction"
- кладет новую конфигурацию nginx которая направляет на эту страничку
- настраивает в sysctl параметр fs.files-max в 1204000 и somaxconn в 65535
- прописывает на этой машинке 2 разных ssh ключа в /root
Целевая ОС - ubuntu 18.04LTS
Код будет доступен команде, которая им же будет производить изменения в проекте (типовые вещи - управление ключами ssh, изменения конфига nginx и т.п.)

###### Ответ
```
тут тоже есть вопросы. 
"2 разных ssh" - где их брать? самому генерить?
"будет производить изменения в проекте типовые вещи - управление ключами ssh" - опять же. они сами будут генерить ключи? необходимо предусмотреть удаление ключей из root?
ansible-playbook question5.yml -e "hostname=server" -e "ansible_user=root" -kK
```
## 6)
> Результат разместите в приватном репозитории на Github.

###### Ответ
    Git Private.
    We are unable to provide access to GitHub private repository services. It appears your account may be based in a U.S.-sanctioned region. As a result, due to U.S. trade controls law restrictions, we are unable to provide private repository services and paid services for your accoun
